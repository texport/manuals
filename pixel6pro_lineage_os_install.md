
## Инструкция по установке LineageOS 20 + MicroG на Google Pixel 6 Pro

LineageOS - это одна из самых популярных прошивок с открытым исходным кодом для Android-устройств, которая основана на исходном коде операционной системы Android. Вот несколько причин, по я считаю LineageOS лучшим выбором по сравнению с другими прошивками:

* Свобода выбора: LineageOS предоставляет пользователям свободу выбора, которую не предоставляет официальная прошивка от производителя устройства. Вы можете устанавливать и настраивать прошивку по своему усмотрению.

* Безопасность: LineageOS активно обновляется и исправляет уязвимости безопасности. Это означает, что вы получаете более безопасную операционную систему, чем официальная прошивка.

* Поддержка старых устройств: LineageOS поддерживает широкий диапазон устройств, включая старые модели, которые больше не обновляются официально. Это означает, что вы можете продлить жизнь своего устройства, получив последнюю версию Android и новые функции.

* Нет предустановленных приложений: LineageOS не включает предустановленные приложения от производителя устройства или поставщика услуг.

В целом, LineageOS представляет собой отличный выбор для пользователей Android, которые хотят больше контроля над своим устройством и не хотят ограничиваться официальной прошивкой от производителя.

Для удобства, инструкция разделена на этапы.

Прежде чем начинать что-то делать обязательно нужно обновить телефон до Android 13, а так же я столкнулся с проблемой, я не смог закрыть загрузчик(bootload lock). Мне пришлось восстанавливать устройство через [утилиту](https://flash.android.com/welcome) от компании Google прежде чем выполнять все действия ниже.

### Этап 1. Разблокировка загрузчика

Загрузчик (bootloader) - это программа, которая запускается при старте устройства Android и предназначена для подготовки системы к запуску операционной системы. Загрузчик находится на специальном разделе во внутренней памяти устройства, и он ответственен за выполнение ряда задач, таких как проверка целостности системных файлов, загрузка ядра операционной системы и загрузочного образа (boot image), настройка системных переменных и запуск пользовательской среды.

Нужно на устройстве активировать режим разработчика.

Активация режима разработчика позволяет получить дополнительные функции и возможности для настройки и управления устройством. Этот режим предназначен для разработчиков Android, но может быть полезен и для обычных пользователей, которые хотят получить больше контроля над своим устройством.

В режиме разработчика нам нужно:

* Разрешить разблокировку загрузчика - это позволяет разблокировать загрузчик устройства и установить на него неофициальные прошивки и модификации.
* Разрешить отладку по USB - это позволяет подключить устройство к компьютеру и управлять им через Android Debug Bridge (adb), что может быть полезно для установки приложений, отладки и тестирования на устройстве.

Теперь выполняем в устройстве

```Настройки -> О телефоне -> Номер сборки(нажимаем до тех пор пока не увидим надпись "Не нужно, вы уже разработчик"```

Теперь переходим

```Настройки -> Система -> Для разработчиков -> Заводская разблокировка(включаем эту опцию) -> Включить -> Отладка по USB(включаем эту опцию) -> OK```

### Этап 2. Подготовка инструментов

Прошивку моего устройства я делал из операционной системы Windows 11.

Нам нужна специальная утилита ADB, качаем последнюю версию от [сюда](https://developer.android.com/studio/releases/platform-tools) для операционной системы Windows.

ADB (Android Debug Bridge) - это инструмент для отладки и тестирования приложений на устройствах Android. Он позволяет разработчикам подключаться к Android-устройствам по USB или Wi-Fi и выполнять различные задачи из командной строки компьютера.

После того как скачали архив, его нужно извлечь в удобное для вас место, я буду извлекать в корень диска ```C:\```

Так же нам нужен будет драйвер для того что бы устройство через adb корректно определялось и работало. Скачивать от [сюда](https://developer.android.com/studio/run/win-usb)

Подключаем устройство к компьютеру через USB кабель. Открываем диспетчер устройств(```Winx+X -> Диспетчер устройств```) и проверяем, определилось ли устройство в системе, если устройство определилось, то продолжаем, если нет, то нужно указать вручную устройству где брать драйвер.

Так же нам необходимо скачать рекавери(vendor_boot.img) и сам образ LineageOS(lineage-20... смотрим на самую свещую дату в названии) по [этой ссылке](https://download.lineageos.org/devices/raven/builds)

### Этап 3. Подготовка устройства

Если все выполнено правильно, то нужно проверить определит ли adb наше устройство. Запускаем командную строку или power shell, для удобства я буду везде говорить терминал. У меня не получилось быстро сделать так, что бы в терминале утилита adb работала всегда, поэтому я буду запускать утилиту adb из папки куда я ее извлек.

*Это делать не обязательно*

Если кого то смущает что нужно все время писать ```adb.exe```, то добавьте директорию с утилитами adb в системную переменную PATH. Для этого нажмите Win+R на клавиатуре, введите "sysdm.cpl" и нажмите "ОК", чтобы открыть свойства системы. Нажмите на кнопку "Переменные среды" и найдите переменную PATH в разделе "Системные переменные". Щелкните на этой переменной и выберите "Изменить". Добавьте путь к директории с утилитами ADB в конец поля "Значение переменной", разделяя его от других путей точкой с запятой (;). Например, если у вас директория находится по адресу C:\platform-tools, то добавьте ";C:\platform-tools" в конец значения переменной PATH.

Переходим в каталог с adb
```cd C:\platform-tools```

Выполняем команду в терминале
```.\adb.exe devices```

После выполнения команды ```.\adb.exe devices``` в терминале будут отображены все подключенные устройства Android, у которых разрешен режим отладки по USB. Каждое устройство будет иметь уникальный идентификатор, известный как "Device ID".

Пример вывода в консоль:
```
List of devices attached
emulator-5554   device
```

Если в терминале устройство отобразилось, то все хорошо.

Теперь перезагружаем устройство в bootloader

```.\adb.exe reboot bootloader```

Как только устройство загрузилось нужно проверить находит ли его компьютер с помощью утилиты fastboot

```.\fasboot devices```

Если выводе в командной строки устройство отобразилось, то все хорошо.

Разблокируем загрузчик
```.\fastboot flashing unlock```

Качельками громкости выбираем что хотим открыть загрузчик, клавишей блокировки соглашаемся.

### Этап 4. Прошивка

Прошиваем vendor_boot.img
```fastboot flash vendor_boot <vendor_boot>.img``` не забываем указать полный путь к файлу vendor_boot.img на диске

Грузимся в Recovery. Качельками громкости выбираем Recovery Mode, клавишей блокировки подтверждаем выбор. Ждем пока загрузится режим Recovery. Обязательно должен быть логотип LineageOS в Recovery Mode.

Делаем FactoryReset и FormatData, так же выбрав этот пункт качельками громкости и клавишей блокировки.

```Factory reset -> Format data/factory reset -> Format data```

Выходим назад, нажав на экране назад.

Теперь прошиваем сам образ LineageOS

```Apply update -> Apply from ADB```

Выполняем команду в терминале

```\.adb sideload <filename>.zip``` <filename> меняем на путь куда скачан образ LineageOS включая само название файла образа

У меня загрузка все время зависала на 6, 7, 8% пока я не подключил устройство через обычный USB-C - USB-A кабель. Из коробки с устройством идет USB-C - USB -C кабель.

После того как прошивка прошла перезагружаем устройство, делаем первичные настройки и подключаемся к беспроводной сети.

### Этап 5. Magisk

Magisk - это программа, которая позволяет пользователям Android получать root-права на своих устройствах без изменения системных файлов. Это означает, что Magisk позволяет пользователю получить полный доступ к системе и выполнить различные задачи, такие как установка модификаций системы, настройка различных параметров, скрытие рут-прав от приложений, которые проверяют их наличие, и т.д., не изменяя саму систему и не нарушая ее целостность.

Скачиваем по [этой ссылке](https://magiskmanager.com/) Magisk для того что бы получить полные права в операционной системе. Нужно изменить у скаченного файла расширение с .apk на .zip и перезагрузить телефон в Recovery Mode.

```.\adb.exe reboot bootloader```

Грузимся в Recovery. Качельками громкости выбираем Recovery Mode, клавишей блокировки подтверждаем выбор. Ждем пока загрузится режим Recovery.

Выходим назад и выбираем

```Apply update -> Apply from ADB```

Выполняем команду в командной строке

```\.adb sideload <filename>.zip``` <filename> нужно заменить на название файла приложения Magisk

После того как процесс установки завершится перезагружаем устройство.

Запускаем приложение Magisk и в настройках включаем Zygisk

Zygisk - позволяет изолировать процессы приложений, которые требуют root-доступа, от остальных процессов на устройстве. Это позволяет предотвратить возможные конфликты с другими процессами и уменьшить нагрузку на систему.

```Magisk -> Настройки -> Zygisk```

Скачиваем последнюю версию LSPosed Zygisk(не путать с riru) по [ссылке](https://github.com/LSPosed/LSPosed/releases)

LSPosed для Magisk позволяет пользователям использовать хуки, чтобы изменять и настраивать поведение приложений на устройстве Android, добавлять дополнительные функции, скрывать рекламу и многое другое. Кроме того, LSPosed для Magisk поддерживает модули, которые можно загрузить из репозитория, чтобы добавить дополнительную функциональность или изменить поведение системы.

Скаченный файл нужно скопировать на телефон, я скопировал в папку Downloads.

Запускаем Magisk

```Magisk -> Модули -> Установить из хранилища -> выбрать скопированный файл(LSPosed) -> Перезагрузка```

Свайпаем шторку, нажимаем на уведомление от LSPosed и нажимаем на 

```Ярлык -> Добавить на главный экран```

Открываем приложение LSPosed

```LSPosed -> Репозитории -> ищем модуль FakeGApps -> Версии -> Установить```

Модуль FakeGApps LSPosed содержит набор имитированных сервисов Google Play, таких как Google Cloud Messaging, Google Location Services, Google Drive, Google Play Games и другие, которые могут использоваться в приложениях, требующих Google Play Services.

После того как модуль установился включаем его.

### Этап 6. Установка MicroG

После установки и настройки LineageOS нужно опять включить режим разработчика и включить отладку USB.

Теперь почему microG, а не gapps.

MicroG - это альтернативный пакет приложений Google, который имеет открытый исходный код и позволяет использовать функциональность Google без необходимости устанавливать полный набор Google Apps (GApps). Это может быть полезно для пользователей, которые хотят использовать Android без Google, но все еще хотят иметь доступ к некоторым функциям, таким как магазин приложений Google Play. MicroG включает в себя ряд замененных Google сервисов, таких как Google Cloud Messaging (GCM), Google Maps API и Google Play Services.

OpenGApps - это пакет приложений и служб Google, доступный для установки на устройства с открытым исходным кодом операционной системы Android, такие как LineageOS. Эти приложения включают в себя Google Play, YouTube, Google Chrome и другие популярные приложения и сервисы Google.

Основная разница между MicroG и OpenGApps заключается в том, что MicroG предоставляет открытую реализацию сервисов Google, которая не требует установки настоящих сервисов Google, тогда как Open GApps предоставляет полный пакет приложений и сервисов Google, включая Google Play Store и Google Play Services. 

Для установки нам понадобится утилита adb

Скачиваем по [этой ссылке](https://github.com/nift4/microg_installer_revived/releases) zip архив с названием microG_Installer_Revived.zip и копируем файл на телефон

Открываем Magisk

```Magisk -> Модули -> Установить из хранилища -> выбрать скопированный файл(microG_Installer_Revived.zip) -> Перезагрузка```

Теперь открываем настройки microG

```Настройки microG -> Проверка работоспособности```

Должны стоять галочки везде.

### Этап 7. Магазины

Скачиваем по [этой ссылки](https://f-droid.org/F-Droid.apk) магазин opensource приложений F-Droid.

F-Droid представляет собой альтернативу Google Play Store и предоставляет пользователю доступ к бесплатным и открытым приложениям, которые могут быть загружены и установлены на устройство без каких-либо ограничений. В каталоге F-Droid представлены приложения, которые соответствуют определенным стандартам, таким как свобода использования, безопасность и конфиденциальность данных, и которые не содержат встроенной рекламы или шпионских приложений.

С помощью командной строки устанавливаем все приложения

```.\adb.exe install <filename>.apk``` за место <filename> указываем название каждого скаченного apk файла

Я не буду устанавливать ```Play Market```, все нужные мне приложения такие как банкинги я буду брать с помощью приложения ```Aurora Store``` приложение ищем в F-Droid и устанавливаем его. Авторизацию в Aurora Store я не использую, скачиваю приложения анонимно.

### Этап 8. Блокируем загрузчик

Перезагружаем в режим bootloader через терминал

```.\adb.exe reboot bootloader```

выполняем команду

```.\fastboot flashing lock```

Качельками громкости выбираем что хотим закрыть загрузчик, клавишей блокировки соглашаемся.










